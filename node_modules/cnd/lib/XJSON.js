// Generated by CoffeeScript 2.4.1
(function() {
  //###########################################################################################################
  var CND, log, rpr;

  CND = require('./main');

  rpr = CND.rpr;

  log = console.log;

  // badge                     = 'scratch'
  // log                       = CND.get_logger 'plain',     badge
  // info                      = CND.get_logger 'info',      badge
  // whisper                   = CND.get_logger 'whisper',   badge
  // alert                     = CND.get_logger 'alert',     badge
  // debug                     = CND.get_logger 'debug',     badge
  // warn                      = CND.get_logger 'warn',      badge
  // help                      = CND.get_logger 'help',      badge
  // urge                      = CND.get_logger 'urge',      badge
  // echo                      = CND.echo.bind CND
  // rainbow                   = CND.rainbow.bind CND
  // suspend                   = require 'coffeenode-suspend'
  // step                      = suspend.step
  // after                     = suspend.after
  // eventually                = suspend.eventually
  // immediately               = suspend.immediately
  // every                     = suspend.every

  //-----------------------------------------------------------------------------------------------------------
  this.replacer = function(key, value) {
    var data, local, type;
    /* NOTE Buffers are treated specially; at this point, they are already converted into sth that looks
    like `{ type: 'Buffer', data: [ ... ], }`. */
    if ((CND.isa_pod(value)) && (value['type'] === 'Buffer') && (CND.isa_list(data = value['data']))) {
      return {
        '~isa': '-x-buffer',
        '%self': data
      };
    }
    //.........................................................................................................
    switch (type = CND.type_of(value)) {
      //.......................................................................................................
      case 'nan':
        return {
          '~isa': '-x-nan'
        };
      //.......................................................................................................
      case 'set':
        return {
          '~isa': '-x-set',
          '%self': Array.from(value)
        };
      case 'map':
        return {
          '~isa': '-x-map',
          '%self': Array.from(value)
        };
      case 'function':
        return {
          '~isa': '-x-function',
          '%self': value.toString()
        };
      //.......................................................................................................
      case 'symbol':
        data = value.toString().replace(/^Symbol\((.*)\)$/, '$1');
        local = value === Symbol.for(data);
        return {
          '~isa': '-x-symbol',
          local,
          '%self': data
        };
    }
    //.........................................................................................................
    return value;
  };

  //-----------------------------------------------------------------------------------------------------------
  this.reviver = function(key, value) {
    var type;
    //.........................................................................................................
    switch (type = CND.type_of(value)) {
      //.......................................................................................................
      case '-x-nan':
        return 0/0;
      //.......................................................................................................
      case '-x-buffer':
        return Buffer.from(value['%self']);
      case '-x-set':
        return new Set(value['%self']);
      case '-x-map':
        return new Map(value['%self']);
      case '-x-function':
        return (eval("[ " + value['%self'] + " ]"))[0];
      case '-x-symbol':
        return Symbol.for(value['%self']);
    }
    //.........................................................................................................
    return value;
  };

  //-----------------------------------------------------------------------------------------------------------
  this.stringify = function(value, replacer, spaces) {
    if (replacer == null) {
      replacer = this.replacer;
    }
    return JSON.stringify(value, replacer, spaces);
  };

  //-----------------------------------------------------------------------------------------------------------
  this.parse = function(text, reviver) {
    if (reviver == null) {
      reviver = this.reviver;
    }
    return JSON.parse(text, reviver);
  };

  //-----------------------------------------------------------------------------------------------------------
  this.replacer = this.replacer.bind(this);

  this.reviver = this.reviver.bind(this);

  this.stringify = this.stringify.bind(this);

  this.parse = this.parse.bind(this);

}).call(this);

//# sourceMappingURL=XJSON.js.map
