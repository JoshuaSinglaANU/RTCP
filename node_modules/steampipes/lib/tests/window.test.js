// Generated by CoffeeScript 2.5.1
(function() {
  'use strict';
  var $, $async, CND, SP, alert, badge, debug, echo, help, info, log, praise, rpr, test, urge, warn, whisper,
    modulo = function(a, b) { return (+a % (b = +b) + b) % b; };

  //###########################################################################################################
  CND = require('cnd');

  rpr = CND.rpr.bind(CND);

  badge = 'STEAMPIPES/TESTS/WINDOW';

  log = CND.get_logger('plain', badge);

  info = CND.get_logger('info', badge);

  whisper = CND.get_logger('whisper', badge);

  alert = CND.get_logger('alert', badge);

  debug = CND.get_logger('debug', badge);

  warn = CND.get_logger('warn', badge);

  help = CND.get_logger('help', badge);

  urge = CND.get_logger('urge', badge);

  praise = CND.get_logger('praise', badge);

  echo = CND.echo.bind(CND);

  //...........................................................................................................
  test = require('guy-test');

  SP = require('../..');

  ({$, $async} = SP);

  //-----------------------------------------------------------------------------------------------------------
  this["WINDOWING $window"] = async function(T, done) {
    var error, i, len, matcher, probe, probes_and_matchers;
    //.........................................................................................................
    probes_and_matchers = [[[[1, 2, 3, 4], 1, null], [[1], [2], [3], [4]], null], [[[1, 2, 3, 4], 2, null], [[null, 1], [1, 2], [2, 3], [3, 4], [4, null]], null], [[[1, 2, 3, 4], 3, null], [[null, null, 1], [null, 1, 2], [1, 2, 3], [2, 3, 4], [3, 4, null], [4, null, null]], null], [[[1, 2, 3, 4], 4, null], [[null, null, null, 1], [null, null, 1, 2], [null, 1, 2, 3], [1, 2, 3, 4], [2, 3, 4, null], [3, 4, null, null], [4, null, null, null]], null], [[[1, 2, 3, 4], 5, null], [[null, null, null, null, 1], [null, null, null, 1, 2], [null, null, 1, 2, 3], [null, 1, 2, 3, 4], [1, 2, 3, 4, null], [2, 3, 4, null, null], [3, 4, null, null, null], [4, null, null, null, null]], null], [[[1], 1, null], [[1]], null], [[[1], 2, null], [[null, 1], [1, null]], null], [[[1], 3, null], [[null, null, 1], [null, 1, null], [1, null, null]], null], [[[1], 4, null], [[null, null, null, 1], [null, null, 1, null], [null, 1, null, null], [1, null, null, null]], null], [[[], 1, null], [], null], [[[], 2, null], [], null], [[[], 3, null], [], null], [[[], 4, null], [], null], [[[1, 2, 3], 0, null], [], 'not a valid pipestreams_\\$window_settings'], [[[1], 2, 'novalue'], [['novalue', 1], [1, 'novalue']], null]];
//.........................................................................................................
    for (i = 0, len = probes_and_matchers.length; i < len; i++) {
      [probe, matcher, error] = probes_and_matchers[i];
      await T.perform(probe, matcher, error, function() {
        return new Promise(function(resolve, reject) {
          var fallback, pipeline, source, values, width;
          [values, width, fallback] = probe;
          source = SP.new_value_source(values);
          pipeline = [];
          pipeline.push(source);
          pipeline.push(SP.$window({width, fallback}));
          pipeline.push(SP.$show());
          pipeline.push(SP.$drain(function(result) {
            return resolve(result);
          }));
          SP.pull(...pipeline);
          return null;
        });
      });
    }
    done();
    return null;
  };

  //-----------------------------------------------------------------------------------------------------------
  this["WINDOWING $window(), window() (2)"] = async function(T, done) {
    var error, i, len, matcher, probe, probes_and_matchers;
    //.........................................................................................................
    probes_and_matchers = [
      [
        {
          values: 'AABXXDXEFG',
          width: 2
        },
        'ABXDXEFG'
      ]
    ];
//.........................................................................................................
    for (i = 0, len = probes_and_matchers.length; i < len; i++) {
      [probe, matcher, error] = probes_and_matchers[i];
      await T.perform(probe, matcher, error, function() {
        return new Promise(function(resolve, reject) {
          var fallback, pipeline, source, values, width;
          ({values, width} = probe);
          fallback = Symbol('fallback');
          source = SP.new_value_source(values);
          pipeline = [];
          pipeline.push(source);
          pipeline.push(SP.window({width, fallback}, $(function(dx, send) {
            var first_d, second_d;
            [first_d, second_d] = dx;
            if (first_d === fallback) {
              return send(second_d);
            }
            if (second_d === fallback) {
              return;
            }
            if (!(second_d === first_d)) {
              return send(second_d);
            }
          })));
          // pipeline.push SP.$window { width, }
          pipeline.push(SP.$show());
          pipeline.push(SP.$drain(function(result) {
            return resolve(result.join(''));
          }));
          // pipeline.push SP.$drain ( result ) -> resolve undefined
          SP.pull(...pipeline);
          return null;
        });
      });
    }
    done();
    return null;
  };

  //-----------------------------------------------------------------------------------------------------------
  this["WINDOWING window with leapfrogging"] = async function(T, done) {
    var error, i, len, matcher, probe, probes_and_matchers;
    //.........................................................................................................
    probes_and_matchers = [[[[1, 2, 3, 4], 1, null], [1, [2], 3, [4]], "leapfrogging with windowing not yet implemented"]];
//.........................................................................................................
// [[[1,2,3,4],1,null],[1,[2],3,[4]],null]
// [[[1,2,3,4],2,null],[1,[null,2],3,[2,4],[4,null]],null]
// [[[1,2,3,4],3,null],[1,[null,null,2],3,[null,2,4],[2,4,null],[4,null,null]],null]
// [[[1,2,3,4],4,null],[1,[null,null,null,2],3,[null,null,2,4],[null,2,4,null],[2,4,null,null],[4,null,null,null]],null]
// [[[1,2,3,4],5,null],[1,[null,null,null,null,2],3,[null,null,null,2,4],[null,null,2,4,null],[null,2,4,null,null],[2,4,null,null,null],[4,null,null,null,null]],null]
// [[[1],1,null],[1],null]
// [[[1],2,null],[1],null]
// [[[1],3,null],[1],null]
// [[[1],4,null],[1],null]
// [[[],1,null],[],null]
// [[[],2,null],[],null]
// [[[],3,null],[],null]
// [[[],4,null],[],null]
// [[[1,2,3],0,null],null,"not a valid pipestreams_\\$window_settings"]
// [[[1],2,"novalue"],[1],null]
// [[[2],2,"novalue"],[["novalue",2],[2,"novalue"]],null]
// [[[1,2],2,"novalue"],[1,["novalue",2],[2,"novalue"]],null]
    for (i = 0, len = probes_and_matchers.length; i < len; i++) {
      [probe, matcher, error] = probes_and_matchers[i];
      await T.perform(probe, matcher, error, function() {
        return new Promise(function(resolve, reject) {
          var fallback, leapfrog, pipeline, source, values, width;
          [values, width, fallback] = probe;
          source = SP.new_value_source(values);
          pipeline = [];
          leapfrog = function(d) {
            return modulo(d, 2) === 1;
          };
          pipeline.push(source);
          pipeline.push(SP.window({width, fallback, leapfrog}, $(function(dx, send) {
            debug('Âµ44772', dx);
            return send(dx);
          })));
          pipeline.push(SP.$show());
          pipeline.push(SP.$drain(function(result) {
            return resolve(result);
          }));
          SP.pull(...pipeline);
          return null;
        });
      });
    }
    done();
    return null;
  };

  //-----------------------------------------------------------------------------------------------------------
  this["WINDOWING $lookaround"] = async function(T, done) {
    var error, i, len, matcher, probe, probes_and_matchers;
    //.........................................................................................................
    probes_and_matchers = [[[[1, 2, 3, 4], 0, null], [[1], [2], [3], [4]], null], [[[1, 2, 3, 4], 1, null], [[null, 1, 2], [1, 2, 3], [2, 3, 4], [3, 4, null]], null], [[[1, 2, 3, 4], 2, null], [[null, null, 1, 2, 3], [null, 1, 2, 3, 4], [1, 2, 3, 4, null], [2, 3, 4, null, null]], null], [[[1], 1, null], [[null, 1, null]], null], [[[], 1, null], [], null], [[[], 2, null], [], null], [[[], 3, null], [], null], [[[], 4, null], [], null], [[[1, 2, 3], -1], [], 'not a valid pipestreams_\\$lookaround_settings'], [[[1], 1, 42], [[42, 1, 42]], null]];
//.........................................................................................................
    for (i = 0, len = probes_and_matchers.length; i < len; i++) {
      [probe, matcher, error] = probes_and_matchers[i];
      await T.perform(probe, matcher, error, function() {
        return new Promise(function(resolve, reject) {
          var delta, fallback, pipeline, source, values;
          [values, delta, fallback] = probe;
          source = SP.new_value_source(values);
          pipeline = [];
          pipeline.push(source);
          pipeline.push(SP.$lookaround({delta, fallback}));
          pipeline.push(SP.$show());
          pipeline.push(SP.$drain(function(result) {
            return resolve(result);
          }));
          SP.pull(...pipeline);
          return null;
        });
      });
    }
    done();
    return null;
  };

  //###########################################################################################################
  if (module.parent == null) {
    test(this);
  }

  // test @[ "WINDOWING $window(), window() (2)" ]
// test @[ "WINDOWING window with leapfrogging" ]

}).call(this);

//# sourceMappingURL=window.test.js.map
