{
  "version": 3,
  "file": "njs-streams-and-files.js",
  "sourceRoot": "..",
  "sources": [
    "src/njs-streams-and-files.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nbadge                     = 'PIPESTREAMS/NJS-STREAMS-AND-FILES'\nFS                        = require 'fs'\nTO_PULL_STREAM            = require 'stream-to-pull-stream'\nTO_NODE_STREAM            = require '../deps/pull-stream-to-stream-patched'\n# TO_NODE_STREAM            = require 'pull-stream-to-stream'\ndefer                     = setImmediate\n\n\n\n#===========================================================================================================\n# READ FROM, WRITE TO FILES, NODEJS STREAMS\n#-----------------------------------------------------------------------------------------------------------\n@read_from_file = ( path, options ) ->\n  ### TAINT consider using https://pull-stream.github.io/#pull-file-reader instead ###\n  switch ( arity = arguments.length )\n    when 1 then null\n    when 2\n      if CND.isa_function options\n        [ path, options, on_end, ] = [ path, null, options, ]\n    else throw new Error \"µ9983 expected 1 or 2 arguments, got #{arity}\"\n  #.........................................................................................................\n  return @read_from_nodejs_stream ( FS.createReadStream path, options )\n\n#-----------------------------------------------------------------------------------------------------------\n@read_chunks_from_file = ( path, byte_count ) ->\n  unless ( CND.isa_number byte_count ) and ( byte_count > 0 ) and ( byte_count is parseInt byte_count )\n    throw new Error \"expected positive integer number, got #{rpr byte_count}\"\n  pfy           = ( require 'util' ).promisify\n  source        = @new_push_source()\n  #.........................................................................................................\n  defer =>\n    fd    = await ( pfy FS.open ) path, 'r'\n    read  = pfy FS.read\n    loop\n      buffer = Buffer.alloc byte_count\n      await read fd, buffer, 0, byte_count, null\n      source.send buffer\n    return null\n  #.........................................................................................................\n  return source\n\n#-----------------------------------------------------------------------------------------------------------\n@write_to_file = ( path, options, on_end ) ->\n  ### TAINT consider to abandon all sinks except `$drain()` and use throughs with writers instead ###\n  ### TAINT consider using https://pull-stream.github.io/#pull-write-file instead ###\n  ### TAINT code duplication ###\n  switch ( arity = arguments.length )\n    when 1 then null\n    when 2\n      if CND.isa_function options\n        [ path, options, on_end, ] = [ path, null, options, ]\n    when 3\n    else throw new Error \"µ9983 expected 1 to 3 arguments, got #{arity}\"\n  #.........................................................................................................\n  R           = @write_to_nodejs_stream ( FS.createWriteStream path, options ), on_end\n  description = { type: 'write_to_file', path, options, on_end, }\n  return @mark_as_sink R, description\n\n#-----------------------------------------------------------------------------------------------------------\n@read_from_nodejs_stream = ( stream ) ->\n  switch ( arity = arguments.length )\n    when 1 then null\n    else throw new Error \"µ9983 expected 1 argument, got #{arity}\"\n  #.........................................................................................................\n  return TO_PULL_STREAM.source stream, ( error ) -> finish error\n\n#-----------------------------------------------------------------------------------------------------------\n@write_to_nodejs_stream = ( stream, on_end ) ->\n  ### TAINT consider to abandon all sinks except `$drain()` and use throughs with writers instead ###\n  ### TAINT code duplication ###\n  switch ( arity = arguments.length )\n    when 1, 2 then null\n    else throw new Error \"µ9983 expected 1 or 2 arguments, got #{arity}\"\n  #.........................................................................................................\n  if on_end? and ( ( type = CND.type_of on_end ) isnt 'function' )\n    throw new Error \"µ9383 expected a function, got a #{type}\"\n  #.........................................................................................................\n  has_finished = false\n  #.........................................................................................................\n  finish = ( error ) ->\n    ### In case there was an error, throw it: ###\n    if error?\n      has_finished = true\n      throw error if error?\n    #.......................................................................................................\n    if not has_finished\n      has_finished = true\n      on_end() if on_end?\n    #.......................................................................................................\n    return null\n  #.........................................................................................................\n  stream.on 'close', -> finish()\n  #.........................................................................................................\n  R           = TO_PULL_STREAM.sink stream, ( error ) -> finish error\n  description = { type: 'write_to_nodejs_stream', stream, on_end, }\n  return @mark_as_sink R, description\n\n#-----------------------------------------------------------------------------------------------------------\n@node_stream_from_source = ( source ) -> TO_NODE_STREAM.source source\n\n#-----------------------------------------------------------------------------------------------------------\n@node_stream_from_sink = ( sink ) ->\n  ### TAINT consider to abandon all sinks except `$drain()` and use throughs with writers instead ###\n  R           = TO_NODE_STREAM.sink sink\n  description = { type: 'node_stream_from_sink', sink, }\n  return @mark_as_sink R, description\n\n\n\n\n\n"
  ]
}